name: Generate Dashboard

on:
  workflow_run:
    workflows: ["Robot Framework Tests"]
    types:
      - completed

jobs:
  process-artifact:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches and tags
          sparse-checkout: db
          ref: "refs/heads/reporting"
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
        cache: 'pip'
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        python -m pip install  -r requirements.txt
      - name: Download artifact from triggering workflow
        uses: actions/download-artifact@v4
        with:
          name: rfoutput  # <-- replace with your actual artifact name
          path: output

      - name: Process artifact with foo
        run: |
          ls -lat  output
          ls -lat  output/
          # robotdashboard --output

      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git diff --cached --quiet || git commit -m "Processed artifact and updated files"
          git push
